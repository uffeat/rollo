<!--
/ref/count.x.html
-->
<style name="sheet">
  ref-component {
    font-weight: 700 !important;
    margin: 1rem;
    margin-left: auto;
  }

  ref-component::after {
    content: attr(current);
    font-weight: initial !important;
  }
</style>

<script type="module">
  const { Mixins, author, component, mix } = await use("@/component");
  const { layout } = await use("@/layout/");
  const { refMixin } = await use("@/state");

  export default async function () {
    const sheet = this.sheet;

    const RefComponent = author(
      class extends mix(HTMLElement, {}, ...Mixins(refMixin)) {},
      "ref-component"
    );

    layout.clear(":not([slot])");

    const state = RefComponent(
      "btn.btn-primary",
      { current: 0, text: "Count: " },
      function () {
        /* Use/unuse sheet */
        this.on._connect$once = (event) => sheet.use();
        this.on._disconnect$once = (event) => sheet.unuse();
        /* Click -> update current */
        this.on.click = (event) => (this.current += 1);
        /* NOTE Add to parent after lifecycle setup */
        layout.append(this);
      }
    );
  }
</script>
