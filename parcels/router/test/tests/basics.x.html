<!--
/basics.x.html
-->
<style name="sheet">
  .nav-link {
    font-size: 1.25rem;
    cursor: pointer;
  }

  .nav-link.active {
    font-weight: 700;
  }
</style>

<script type="module">
  const { component } = await use("@/component.js");
  const { layout } = await use("@/layout/");
  const { router } = await use("@/router.js");

  export default async function () {
    this.sheet.use();
    layout.clear();

    

    /* Define routes */
    [
      ["/", "@@/test/pages/home.js"],
      ["/foo", "/test/pages/foo.js"],
      ["/color", "/test/pages/color.js"],
    ].forEach(([path, usePath]) => {
      router.routes.add({
        [path]: async (...args) => {
          const mod = await use(usePath);
          mod.default(...args);
        },
      });
    });

    router.routes.add({
      "/bar": async(...args) => {
        const result = await use('/test/pages/bar.x.html');
        result(...args)
      }

    })



    /* Create nav */
    const nav = component.nav(
      "nav.d-flex.flex-column",
      { slot: "side", parent: layout },
      ...[
        ["Home", "/"],
        ["About", "/about"],
        ["Foo", "/foo"],
        ["Foo with args", "/foo/ding/dong"],
        ["Bar", "/bar/stuff"],
        ["Color", "/color"],
        ["Color -> green", "/color/green"],
        ["Bad", "/bad"],
      ].map(([text, path]) => component.a("nav-link", { text, $path: path }))
    );

    nav.on.click = async (event) => {
      const target = event.target.closest(`[state-path]`);
      if (target) {
        event.preventDefault();
        router(target.$.path);
      }
      //layout.close();
    };

    router.effects.path.add(
      (current, message) => {
        let active = nav.find(`.active`);
        if (active) {
          active.classes.remove("active");
        }
        active = nav.find(`[state-path="${current}"]`);
        if (active) {
          active.classes.add("active");
        }
      },
      (current) => !!current
    );

    /* Handle initial
    NOTE Do after complete setup */
    await router(location.pathname, { silent: true });
  }
</script>
