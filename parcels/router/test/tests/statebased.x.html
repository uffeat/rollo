<!--
/statebased.x.html

Demo intent
- Routing can be done without registering any routes, but instead using the
  'path' effect.
- State-based routing even captures queries, but not residuals.
- Queries can be set on NavLinks as object using the 'query' prop.
-->

<script type="module">
  const { component } = await use("@/component.js");
  const { layout } = await use("@/layout/");
  const { router, NavLink } = await use("@/router/");

  const heading = component.h1();
  const page = component.main("container", heading);

  const Effect = () => {
    return (current, message, query) => {

     
      console.log('query:', query);


      layout.clear(":not([slot])");
      heading.text = `${current.at(1).toUpperCase()}${current.slice(2)}`;
      layout.append(page);
    };
  };

  export default async function () {
    layout.clear();
    router.effects.path.add(Effect(), { run: false }, ["/foo"]);
    router.effects.path.add(Effect(), { run: false }, ["/bar"]);

    /* Create nav */
    component.nav(
      "nav.d-flex.flex-column",
      { slot: "side", parent: layout },
      ...[
        ["Bar", "/bar", {dong: 'DONG'}],
        ["Foo", "/foo", {ding: 42}],
      ].map(([text, path, query]) => NavLink({ text, path, query }))
    );

    /* Setup */
    await router.setup({ strict: false });
  }
</script>
